/*! rslide - v0.1.0 - 2013-02-18
* http://gwilymh.com/rslide
* Copyright (c) 2013 Gwilym Humphreys; Licensed MIT */
(function(e){var t=function(t,r){this.options=r,this.initElements(t),this.initControls(),this.offset=0,this.offsetItems=0,this.filler=new n(this.$outer,this.$inner,this.$container,this.$items,this.options),e(window).on("orientationchange, resize",e.proxy(this.onResize,this)),this.options.pause==="hover"&&this.$outer.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this)),e.browser.msie&&parseInt(e.browser.version)<9&&(this.terribleBrowser=!0),this.startOnImagesReady()};t.prototype={startOnImagesReady:function(){var t,n=e("img",this.$container);n.load(e.proxy(this.fit,this)),n.each(function(e,n){if(!n.complete)return t=!0,!1}),!t&&this.fit()},fit:function(){this.filler.fitItems(),this.setOffsetByItems(this.offsetItems,0)},adjustOffsetByItems:function(e,t){return this.setOffsetByItems(this.offsetItems+e,t),this},setOffsetByItems:function(e,t){return this.offsetItems=e,this.setOffset(this.offsetItems*this.filler.itemWidth,t),this},setOffset:function(e,t){var n=this;return t=typeof t!="undefined"?t:this.options.slider.duration,this.sliding=!0,this.$outer.trigger("sliding"),this.offset=e,this.terribleBrowser?this.$container.animate({left:-e},t,function(){n.sliding=!1,n.$container.trigger("slid")}):this.$container.transition({x:-e},t,function(){n.sliding=!1,n.$container.trigger("slid")}),this},prev:function(e){e&&e.preventDefault();if(this.sliding)return;return this.sliding=!0,this.adjustOffsetByItems(-this.options.slider.count),this.filler.fillPre(this.options.slider.count,!0),this},next:function(e){e&&e.preventDefault();if(this.sliding)return;return this.sliding=!0,this.adjustOffsetByItems(this.options.slider.count),this.filler.fillPost(this.options.slider.count,!0),this},onResize:function(e){this.setOffsetByItems(0,0),this.fit()},initElements:function(t){this.$container=e(t).wrap('<div class="rslide-inner"></div>').css({padding:0,width:"99999px",margin:"0 auto",position:"relative"}),this.$inner=this.$container.parent().css({position:"relative",overflow:"hidden"}),this.$inner.wrap('<div class="rslide-outer"></div>'),this.$outer=this.$inner.parent().css({position:"relative"}),this.$items=this.$container.children().css({"list-style":"none",position:"absolute"}),this.options.items.fitImages&&this.$items.find(this.options.items.imageSelector).css({width:"100%",height:"auto"})},initControls:function(){return this.options.controls.create?(this.$next=e('<a href="" class="next"></a>').appendTo(this.$outer),this.$prev=e('<a href="" class="prev"></a>').appendTo(this.$outer)):(this.$next=e(this.options.controls.next),this.$prev=e(this.options.controls.prev)),this.$prev.on("click",e.proxy(this.prev,this)),this.$next.on("click",e.proxy(this.next,this)),this.$outer.on("swipeleft",e.proxy(this.next,this)),this.$outer.on("swiperight",e.proxy(this.prev,this)),this}};var n=function(e,t,n,r,i){this.$outer=e,this.$inner=t,this.$container=n,this.$items=r,this.options=i,this.containerWidth=this.options.container.width||this.$inner.width(),this.calcWidths(this.containerWidth),this.preIndex=-1,this.postIndex=0,this.fillPre(this.options.items.buffer,!1),this.fillPost(this.options.items.buffer,!1),this.itemWidth=0};n.prototype={fillPre:function(e,t){var n=this,r=this.getItems(this.$items,this.preIndex,e),i=this.$container.children().first().position().left;return[].reverse.call(r).each(function(e,t){n.$container.prepend(n.itemCss(t,i,n.itemWidth,-(e+1)))}),this.adjustPreIndex(e),t&&this.removePost(e),this},fillPost:function(e,t){var n=this,r=this.getItems(this.$items,this.postIndex,e),i=this.$container.children().last().position().left;return r.each(function(e,t){n.$container.append(n.itemCss(t,i,n.itemWidth,e+1))}),this.adjustPostIndex(e),t&&this.removePre(e),this},removePre:function(e){var t=this.$container.children();return t.slice(0,e).remove(),this.adjustPreIndex(-e),this},removePost:function(e){var t=this.$container.children();return t.slice(-e).remove(),this.adjustPostIndex(-e),this},adjustPreIndex:function(e){return this.preIndex=(this.preIndex-e)%this.$items.length,this},adjustPostIndex:function(e){return this.postIndex=(this.postIndex+e)%this.$items.length,this},fitItems:function(){var t=this,n=this.$inner.width(),r=0;return this.itemCount=this.calcItemCount(n,this.maxWidth),this.itemWidth=this.calcItemWidth(n,this.itemCount),this.$container.children().each(function(n,i){var s=e(i).css({width:t.itemWidth+"px",left:(n-t.options.items.buffer)*t.itemWidth+"px"}).height();r=s>r?s:r}),this.$container.height(r),this},calcWidths:function(e){return this.maxWidth=this.parseUnits(this.options.items.maxWidth,e)||this.getMax(this.$items,"width"),this.minWidth=this.parseUnits(this.options.items.minWidth,e)||this.maxWidth/2,this},calcItemCount:function(e,t){return Math.ceil(e/t)},calcItemWidth:function(e,t){return e/t},getMax:function(t,n){var r=-Infinity;return t.each(function(t,i){var s=n?e(i)[n]():i;s>r&&(r=s)}),r},parseUnits:function(e,t){return typeof e=="string"?e.charAt(e.length-1)=="%"?t*(e.slice(0,e.length-1)/100):(e.slice(-2,e.length)!=="px"&&console&&console.log("rslide: options.items.(max|min)Width must either be undefined, a number, or end with `%` or `px`. You provided: ",e,"("+typeof e+")"),parseFloat(e)):typeof e=="number"?e:undefined},itemCss:function(t,n,r,i){var s=n+i*r+"px",o=e(t).css({width:r+"px",position:"absolute",left:s});return o},getItems:function(t,n,r){var i,s,o=0,u=0;t=t.clone?t.clone():t,n<0&&(n=(t.length+n)%t.length),s=n+r,u=s-t.length,i=t.slice(n,s);if(u>0){var a=this.getItems(t,o,u);e.merge(i,a)}return i}},e.fn.rslide=function(n){return this.each(function(){var r=e(this),i=r.data("rslide"),s=e.extend({},e.fn.rslide.defaults,typeof n=="object"&&n),o=typeof n=="string"?n:s.slide;i||r.data("rslide",i=new t(this,s)),typeof n=="number"?i.to(n):o?i[o]():s.interval&&i.cycle()})},e.fn.rslide.defaults={items:{minWidth:undefined,maxWidth:"25%",min:2,max:4,buffer:1,fitImages:!0,imageSelector:"img"},container:{width:undefined},slider:{count:1,duration:300},controls:{next:"",prev:"",create:!0},pause:"hover"},e.fn.rslide.Constructor=t})(jQuery);